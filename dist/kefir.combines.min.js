!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("kefir"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","kefir","infestines"],e):e((n.Kefir=n.Kefir||{},n.Kefir.combines={}),n.Kefir,n.I)}(this,function(n,e,r){"use strict";function t(n,e){if(h(n))e(n);else if(r.isArray(n))for(var i=0,a=n.length;i<a;++i)t(n[i],e);else if(r.isObject(n))for(var u in n)t(n[u],e)}function i(n){for(var e=0,r=0,t=n.length;r<t;++r)e+=u(n[r]);return e}function a(n){return r.isArray(n)?i(n):r.isObject(n)?function(n){var e=0;for(var r in n)e+=u(n[r]);return e}(n):0}function u(n){return h(n)?1:a(n)}function l(n,e,t){if(h(n))return e[++t.index];if(r.isArray(n)){for(var i=n.length,a=n,u=0;u<i;++u){var o=l(n[u],e,t);r.identicalU(a[u],o)||(a===n&&(a=n.slice(0)),a[u]=o)}return a}if(r.isObject(n)){var f=n;for(var s in n){var c=l(n[s],e,t);r.identicalU(f[s],c)||(f===n&&(f=r.assocPartialU(void 0,void 0,n)),f[s]=c)}return f}return n}function o(n){if(!r.isArray(n))return n;var e=n.length-1,t=n[e];return r.isFunction(t)?t.apply(null,n.slice(0,e)):n}function f(n,e){var t=n._currentEvent;t&&r.identicalU(t.value,e)&&"value"===t.type||n._emitValue(e)}function s(n){var e=i(n);switch(e){case 0:return o(n);case 1:return 2===n.length&&h(n[0])&&r.isFunction(n[1])?new d(n[0],n[1]):new _(n);default:return new v(n,e)}}function c(n){function e(){for(var e=arguments.length,r=Array(e+1),i=0;i<e;++i)r[i]=arguments[i];r[e]=this;var a=s(r);return n&&this.length<=e?a:t(a)}function t(n){if(!r.isFunction(n))return h(n)?y(n,t):n;switch(n.length){case 0:return function(){return e.apply(n,arguments)};case 1:return function(r){return e.apply(n,arguments)};case 2:return function(r,t){return e.apply(n,arguments)};case 3:return function(r,t,i){return e.apply(n,arguments)};case 4:return function(r,t,i,a){return e.apply(n,arguments)};default:return function(n){throw Error("Arity of "+n+" unsupported")}(n)}}return function(n){var e=t(n);return e!==n&&(e.fn=n),e}}var h=function(n){return n instanceof e.Observable},v=r.inherit(function(n,r){e.Property.call(this),this._template=n,this._handlers=r,this._values=null},e.Property,{_onActivation:function(){for(var n,e,r=this._handlers,i=Array(r),a=Array(r),u=0;u<r;++u)a[u]=this,i[u]=this;this._handlers=i,this._values=a,e=-1,t((n=this)._template,function(r){var t=function e(r){for(var t=n._handlers,i=0;t[i]!==e;)++i;switch(r.type){case"value":var a=n._values;a[i]=r.value;for(var u=0,s=a.length;u<s;++u)if(a[u]===n)return;f(n,o(l(n._template,a,{index:-1})));break;case"error":n._emitError(r.value);break;default:t[i]=null;for(var c=0,h=t.length;c<h;++c)if(t[c])return;n._handlers=t.length,n._values=null,n._emitEnd()}};n._handlers[++e]=t,r.onAny(t)})},_onDeactivation:function(){var n=this._handlers;this._handlers=n.length,this._values=null,function(n,e){var r=-1;t(n,function(n){var t=e[++r];t&&n.offAny(t)})}(this._template,n)}}),_=r.inherit(function(n){e.Property.call(this),this._template=n,this._handler=null},e.Property,{_onActivation:function(){var n=this,e=function(e){switch(e.type){case"value":f(n,o(l(n._template,[e.value],{index:-1})));break;case"error":n._emitError(e.value);break;default:n._handler=null,n._emitEnd()}};this._handler=e,t(this._template,function(n){return n.onAny(e)})},_onDeactivation:function(){var n=this._handler;this._handler=null,t(this._template,function(e){return e.offAny(n)})}}),d=r.inherit(function(n,r){e.Property.call(this),this._observable=n,this._fn=r,this._handler=null},e.Property,{_onActivation:function(){var n=this,e=function(e){switch(e.type){case"value":f(n,(0,n._fn)(e.value));break;case"error":n._emitError(e.value);break;default:n._handler=null,n._emitEnd()}};this._handler=e,this._observable.onAny(e)},_onDeactivation:function(){var n=this._handler,e=this._observable;this._handler=null,e.offAny(n)}}),p=function(n){return function(e){if(h(e))return new d(e,n);var r=a(e);return 0===r?n(e):1===r?new _([e,n]):new v([e,n],r)}},y=function(){for(var n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];return s(e)},b=c(!1),m=c(!0);n.lift1Shallow=function(n){return function(e){return h(e)?new d(e,n):n(e)}},n.lift1=p,n.lift=function(n){var e=n.length;switch(e){case 0:return n;case 1:return p(n);default:return r.arityN(e,function(){for(var e=arguments.length,r=Array(e),t=0;t<e;++t)r[t]=arguments[t];var a=i(r);return 0===a?n.apply(null,r):(r.push(n),1===a&&new _(r),new v(r,a))})}},n.combines=y,n.liftRec=b,n.liftFOF=m,n.default=y,Object.defineProperty(n,"__esModule",{value:!0})});
