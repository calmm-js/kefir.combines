!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("kefir"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","kefir","infestines"],e):e((n.kefir=n.kefir||{},n.kefir.combines=n.kefir.combines||{}),n.kefir,n.I)}(this,function(n,e,t){"use strict";function i(n,r){if(n instanceof e.Observable)r(n);else if(t.isArray(n))for(var a=0,s=n.length;a<s;++a)i(n[a],r);else if(t.isObject(n))for(var l in n)i(n[l],r)}function r(n){for(var e=0,t=0,i=n.length;t<i;++t)e+=l(n[t]);return e}function a(n){var e=0;for(var t in n)e+=l(n[t]);return e}function s(n){return t.isArray(n)?r(n):t.isObject(n)?a(n):0}function l(n){return n instanceof e.Observable?1:s(n)}function u(n,e,t){var r=-1;i(n,function(n){var i=function n(e){return t._handleAny(n,e)};e[++r]=i,n.onAny(i)})}function o(n,e){var t=-1;i(n,function(n){var i=e[++t];i&&n.offAny(i)})}function f(n,i,r){if(n instanceof e.Observable)return i[++r.index];if(t.isArray(n)){for(var a=n.length,s=n,l=0;l<a;++l){var u=f(n[l],i,r);t.identicalU(s[l],u)||(s===n&&(s=n.slice(0)),s[l]=u)}return s}if(t.isObject(n)){var o=n;for(var h in n){var c=f(n[h],i,r);t.identicalU(o[h],c)||(o===n&&(o=t.assocPartialU(void 0,void 0,n)),o[h]=c)}return o}return n}function h(n){if(!(n instanceof Array))return n;var e=n.length-1,t=n[e];return t instanceof Function?t.apply(void 0,n.slice(0,e)):n}function c(){e.Property.call(this)}function v(n,e){c.call(this),this._template=n,this._handlers=e,this._values=null}function _(n){c.call(this),this._template=n,this._handler=null}function d(n,e){c.call(this),this._observable=n,this._fn=e,this._handler=null}function y(n){var e=n.length;switch(e){case 0:return n;case 1:return m(n);default:return t.arityN(e,function(){for(var e=arguments.length,t=Array(e),i=0;i<e;++i)t[i]=arguments[i];var a=r(t);return 0===a?n.apply(null,t):(t.push(n),1===a&&new _(t),new v(t,a))})}}t.inherit(c,e.Property,{_maybeEmitValue:function(n){var e=this._currentEvent;e&&t.identicalU(e.value,n)||this._emitValue(n)}}),t.inherit(v,c,{_onActivation:function(){for(var n=this._template,e=this._handlers,t=Array(e),i=Array(e),r=0;r<e;++r)i[r]=this,t[r]=this;this._handlers=t,this._values=i,u(n,t,this)},_handleAny:function(n,e){for(var t=this._handlers,i=0;t[i]!==n;)++i;switch(e.type){case"value":var r=this._values;r[i]=e.value;for(var a=0,s=r.length;a<s;++a)if(r[a]===this)return;this._maybeEmitValue(h(f(this._template,r,{index:-1})));break;case"error":this._emitError(e.value);break;default:t[i]=null;for(var l=0,u=t.length;l<u;++l)if(t[l])return;this._handlers=t.length,this._values=null,this._emitEnd()}},_onDeactivation:function(){var n=this._handlers;this._handlers=n.length,this._values=null,o(this._template,n)}}),t.inherit(_,c,{_onActivation:function(){var n=this,e=function(e){return n._handleAny(e)};this._handler=e,i(this._template,function(n){return n.onAny(e)})},_handleAny:function(n){switch(n.type){case"value":this._maybeEmitValue(h(f(this._template,[n.value],{index:-1})));break;case"error":this._emitError(n.value);break;default:this._handler=null,this._emitEnd()}},_onDeactivation:function(){var n=this._handler;this._handler=null,i(this._template,function(e){return e.offAny(n)})}}),t.inherit(d,c,{_onActivation:function(){var n=this,e=function(e){return n._handleAny(e)};this._handler=e,this._observable.onAny(e)},_handleAny:function(n){switch(n.type){case"value":this._maybeEmitValue(this._fn(n.value));break;case"error":this._emitError(n.value);break;default:this._handler=null,this._emitEnd()}},_onDeactivation:function(){var n=this._handler,e=this._observable;this._handler=null,e.offAny(n)}});var b=function(n){return function(t){return t instanceof e.Observable?new d(t,n):n(t)}},m=function(n){return function(t){if(t instanceof e.Observable)return new d(t,n);var i=s(t);return 0===i?n(t):1===i?new _([t,n]):new v([t,n],i)}},p=function(){for(var n=arguments.length,t=Array(n),i=0;i<n;i++)t[i]=arguments[i];var a=r(t);switch(a){case 0:return h(t);case 1:return 2===t.length&&t[0]instanceof e.Observable&&t[1]instanceof Function?new d(t[0],t[1]):new _(t);default:return new v(t,a)}};n.lift1Shallow=b,n.lift1=m,n.lift=y,n.default=p,Object.defineProperty(n,"__esModule",{value:!0})});
