!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("kefir"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","kefir","infestines"],e):e((n.Kefir=n.Kefir||{},n.Kefir.combines={}),n.Kefir,n.I)}(this,function(n,e,r){"use strict";function t(n,i){if(n instanceof e.Observable)i(n);else if(r.isArray(n))for(var a=0,u=n.length;a<u;++a)t(n[a],i);else if(r.isObject(n))for(var l in n)t(n[l],i)}function i(n){for(var e=0,r=0,t=n.length;r<t;++r)e+=u(n[r]);return e}function a(n){return r.isArray(n)?i(n):r.isObject(n)?function(n){var e=0;for(var r in n)e+=u(n[r]);return e}(n):0}function u(n){return n instanceof e.Observable?1:a(n)}function l(n,t,i){if(n instanceof e.Observable)return t[++i.index];if(r.isArray(n)){for(var a=n.length,u=n,o=0;o<a;++o){var s=l(n[o],t,i);r.identicalU(u[o],s)||(u===n&&(u=n.slice(0)),u[o]=s)}return u}if(r.isObject(n)){var f=n;for(var c in n){var h=l(n[c],t,i);r.identicalU(f[c],h)||(f===n&&(f=r.assocPartialU(void 0,void 0,n)),f[c]=h)}return f}return n}function o(n){if(!r.isArray(n))return n;var e=n.length-1,t=n[e];return r.isFunction(t)?t.apply(null,n.slice(0,e)):n}function s(n,e){var t=n._currentEvent;t&&r.identicalU(t.value,e)&&"value"===t.type||n._emitValue(e)}function f(n){var r=i(n);switch(r){case 0:return o(n);case 1:return 2===n.length&&n[0]instanceof e.Observable&&n[1]instanceof Function?new d(n[0],n[1]):new _(n);default:return new v(n,r)}}function c(){for(var n=arguments.length,e=Array(n+1),r=0;r<n;++r)e[r]=arguments[r];return e[n]=this,h(f(e))}function h(n){if(!r.isFunction(n))return n instanceof e.Observable?y(n,h):n;switch(n.length){case 0:return function(){return c.apply(n,arguments)};case 1:return function(e){return c.apply(n,arguments)};case 2:return function(e,r){return c.apply(n,arguments)};case 3:return function(e,r,t){return c.apply(n,arguments)};case 4:return function(e,r,t,i){return c.apply(n,arguments)};default:return function(n){throw Error("Arity of "+n+" unsupported")}(n)}}var v=r.inherit(function(n,r){e.Property.call(this),this._template=n,this._handlers=r,this._values=null},e.Property,{_onActivation:function(){for(var n,e,r=this._handlers,i=Array(r),a=Array(r),u=0;u<r;++u)a[u]=this,i[u]=this;this._handlers=i,this._values=a,e=-1,t((n=this)._template,function(r){var t=function e(r){for(var t=n._handlers,i=0;t[i]!==e;)++i;switch(r.type){case"value":var a=n._values;a[i]=r.value;for(var u=0,f=a.length;u<f;++u)if(a[u]===n)return;s(n,o(l(n._template,a,{index:-1})));break;case"error":n._emitError(r.value);break;default:t[i]=null;for(var c=0,h=t.length;c<h;++c)if(t[c])return;n._handlers=t.length,n._values=null,n._emitEnd()}};n._handlers[++e]=t,r.onAny(t)})},_onDeactivation:function(){var n=this._handlers;this._handlers=n.length,this._values=null,function(n,e){var r=-1;t(n,function(n){var t=e[++r];t&&n.offAny(t)})}(this._template,n)}}),_=r.inherit(function(n){e.Property.call(this),this._template=n,this._handler=null},e.Property,{_onActivation:function(){var n=this,e=function(e){switch(e.type){case"value":s(n,o(l(n._template,[e.value],{index:-1})));break;case"error":n._emitError(e.value);break;default:n._handler=null,n._emitEnd()}};this._handler=e,t(this._template,function(n){return n.onAny(e)})},_onDeactivation:function(){var n=this._handler;this._handler=null,t(this._template,function(e){return e.offAny(n)})}}),d=r.inherit(function(n,r){e.Property.call(this),this._observable=n,this._fn=r,this._handler=null},e.Property,{_onActivation:function(){var n=this,e=function(e){switch(e.type){case"value":s(n,(0,n._fn)(e.value));break;case"error":n._emitError(e.value);break;default:n._handler=null,n._emitEnd()}};this._handler=e,this._observable.onAny(e)},_onDeactivation:function(){var n=this._handler,e=this._observable;this._handler=null,e.offAny(n)}}),p=function(n){return function(r){if(r instanceof e.Observable)return new d(r,n);var t=a(r);return 0===t?n(r):1===t?new _([r,n]):new v([r,n],t)}},y=function(){for(var n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];return f(e)};n.lift1Shallow=function(n){return function(r){return r instanceof e.Observable?new d(r,n):n(r)}},n.lift1=p,n.lift=function(n){var e=n.length;switch(e){case 0:return n;case 1:return p(n);default:return r.arityN(e,function(){for(var e=arguments.length,r=Array(e),t=0;t<e;++t)r[t]=arguments[t];var a=i(r);return 0===a?n.apply(null,r):(r.push(n),1===a&&new _(r),new v(r,a))})}},n.combines=y,n.liftRec=h,n.default=y,Object.defineProperty(n,"__esModule",{value:!0})});
