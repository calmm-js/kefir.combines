!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("kefir"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","kefir","infestines"],n):n((e.kefir=e.kefir||{},e.kefir.combines={}),e.Kefir,e.I)}(this,function(e,n,t){"use strict";function r(e,i){if(e instanceof n.Observable)i(e);else if(t.isArray(e))for(var a=0,l=e.length;a<l;++a)r(e[a],i);else if(t.isObject(e))for(var o in e)r(e[o],i)}function i(e){for(var n=0,t=0,r=e.length;t<r;++t)n+=o(e[t]);return n}function a(e){var n=0;for(var t in e)n+=o(e[t]);return n}function l(e){return t.isArray(e)?i(e):t.isObject(e)?a(e):0}function o(e){return e instanceof n.Observable?1:l(e)}function u(e,r,i){if(e instanceof n.Observable)return r[++i.index];if(t.isArray(e)){for(var a=e.length,l=e,o=0;o<a;++o){var s=u(e[o],r,i);t.identicalU(l[o],s)||(l===e&&(l=e.slice(0)),l[o]=s)}return l}if(t.isObject(e)){var f=e;for(var c in e){var h=u(e[c],r,i);t.identicalU(f[c],h)||(f===e&&(f=t.assocPartialU(void 0,void 0,e)),f[c]=h)}return f}return e}function s(e){if(!(e instanceof Array))return e;var n=e.length-1,t=e[n];return t instanceof Function?t.apply(void 0,e.slice(0,n)):e}function f(e){var n=-1;r(e._template,function(t){var r=function n(t){for(var r=e._handlers,i=0;r[i]!==n;)++i;switch(t.type){case"value":var a=e._values;a[i]=t.value;for(var l=0,o=a.length;l<o;++l)if(a[l]===e)return;var f=e._template;h(e,s(u(f,a,{index:-1})));break;case"error":e._emitError(t.value);break;default:r[i]=null;for(var c=0,v=r.length;c<v;++c)if(r[c])return;e._handlers=r.length,e._values=null,e._emitEnd()}};e._handlers[++n]=r,t.onAny(r)})}function c(e,n){var t=-1;r(e,function(e){var r=n[++t];r&&e.offAny(r)})}function h(e,n){var r=e._currentEvent;r&&t.identicalU(r.value,n)&&"value"===r.type||e._emitValue(n)}var v=t.inherit(function(e,t){n.Property.call(this),this._template=e,this._handlers=t,this._values=null},n.Property,{_onActivation:function(){for(var e=this._handlers,n=Array(e),t=Array(e),r=0;r<e;++r)t[r]=this,n[r]=this;this._handlers=n,this._values=t,f(this)},_onDeactivation:function(){var e=this._handlers;this._handlers=e.length,this._values=null,c(this._template,e)}}),_=t.inherit(function(e){n.Property.call(this),this._template=e,this._handler=null},n.Property,{_onActivation:function(){var e=this,n=function(n){switch(n.type){case"value":var t=e._template;h(e,s(u(t,[n.value],{index:-1})));break;case"error":e._emitError(n.value);break;default:e._handler=null,e._emitEnd()}};this._handler=n,r(this._template,function(e){return e.onAny(n)})},_onDeactivation:function(){var e=this._handler;this._handler=null,r(this._template,function(n){return n.offAny(e)})}}),d=t.inherit(function(e,t){n.Property.call(this),this._observable=e,this._fn=t,this._handler=null},n.Property,{_onActivation:function(){var e=this,n=function(n){switch(n.type){case"value":h(e,(0,e._fn)(n.value));break;case"error":e._emitError(n.value);break;default:e._handler=null,e._emitEnd()}};this._handler=n,this._observable.onAny(n)},_onDeactivation:function(){var e=this._handler,n=this._observable;this._handler=null,n.offAny(e)}}),y=function(e){return function(t){if(t instanceof n.Observable)return new d(t,e);var r=l(t);return 0===r?e(t):1===r?new _([t,e]):new v([t,e],r)}};e.lift1Shallow=function(e){return function(t){return t instanceof n.Observable?new d(t,e):e(t)}},e.lift1=y,e.lift=function(e){var n=e.length;switch(n){case 0:return e;case 1:return y(e);default:return t.arityN(n,function(){for(var n=arguments.length,t=Array(n),r=0;r<n;++r)t[r]=arguments[r];var a=i(t);return 0===a?e.apply(null,t):(t.push(e),1===a&&new _(t),new v(t,a))})}},e.default=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=i(t);switch(a){case 0:return s(t);case 1:return 2===t.length&&t[0]instanceof n.Observable&&t[1]instanceof Function?new d(t[0],t[1]):new _(t);default:return new v(t,a)}},Object.defineProperty(e,"__esModule",{value:!0})});
