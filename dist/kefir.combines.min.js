!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("kefir"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","kefir","infestines"],n):n((e.Kefir=e.Kefir||{},e.Kefir.combines={}),e.Kefir,e.I)}(this,function(e,n,t){"use strict";function r(e,i){if(e instanceof n.Observable)i(e);else if(t.isArray(e))for(var a=0,l=e.length;a<l;++a)r(e[a],i);else if(t.isObject(e))for(var o in e)r(e[o],i)}function i(e){for(var n=0,t=0,r=e.length;t<r;++t)n+=l(e[t]);return n}function a(e){return t.isArray(e)?i(e):t.isObject(e)?function(e){var n=0;for(var t in e)n+=l(e[t]);return n}(e):0}function l(e){return e instanceof n.Observable?1:a(e)}function o(e,r,i){if(e instanceof n.Observable)return r[++i.index];if(t.isArray(e)){for(var a=e.length,l=e,u=0;u<a;++u){var s=o(e[u],r,i);t.identicalU(l[u],s)||(l===e&&(l=e.slice(0)),l[u]=s)}return l}if(t.isObject(e)){var f=e;for(var c in e){var h=o(e[c],r,i);t.identicalU(f[c],h)||(f===e&&(f=t.assocPartialU(void 0,void 0,e)),f[c]=h)}return f}return e}function u(e){if(!(e instanceof Array))return e;var n=e.length-1,t=e[n];return t instanceof Function?t.apply(void 0,e.slice(0,n)):e}function s(e,n){var r=e._currentEvent;r&&t.identicalU(r.value,n)&&"value"===r.type||e._emitValue(n)}function f(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=i(t);switch(a){case 0:return u(t);case 1:return 2===t.length&&t[0]instanceof n.Observable&&t[1]instanceof Function?new v(t[0],t[1]):new h(t);default:return new c(t,a)}}var c=t.inherit(function(e,t){n.Property.call(this),this._template=e,this._handlers=t,this._values=null},n.Property,{_onActivation:function(){for(var e,n,t=this._handlers,i=Array(t),a=Array(t),l=0;l<t;++l)a[l]=this,i[l]=this;this._handlers=i,this._values=a,n=-1,r((e=this)._template,function(t){var r=function n(t){for(var r=e._handlers,i=0;r[i]!==n;)++i;switch(t.type){case"value":var a=e._values;a[i]=t.value;for(var l=0,f=a.length;l<f;++l)if(a[l]===e)return;s(e,u(o(e._template,a,{index:-1})));break;case"error":e._emitError(t.value);break;default:r[i]=null;for(var c=0,h=r.length;c<h;++c)if(r[c])return;e._handlers=r.length,e._values=null,e._emitEnd()}};e._handlers[++n]=r,t.onAny(r)})},_onDeactivation:function(){var e=this._handlers;this._handlers=e.length,this._values=null,function(e,n){var t=-1;r(e,function(e){var r=n[++t];r&&e.offAny(r)})}(this._template,e)}}),h=t.inherit(function(e){n.Property.call(this),this._template=e,this._handler=null},n.Property,{_onActivation:function(){var e=this,n=function(n){switch(n.type){case"value":s(e,u(o(e._template,[n.value],{index:-1})));break;case"error":e._emitError(n.value);break;default:e._handler=null,e._emitEnd()}};this._handler=n,r(this._template,function(e){return e.onAny(n)})},_onDeactivation:function(){var e=this._handler;this._handler=null,r(this._template,function(n){return n.offAny(e)})}}),v=t.inherit(function(e,t){n.Property.call(this),this._observable=e,this._fn=t,this._handler=null},n.Property,{_onActivation:function(){var e=this,n=function(n){switch(n.type){case"value":s(e,(0,e._fn)(n.value));break;case"error":e._emitError(n.value);break;default:e._handler=null,e._emitEnd()}};this._handler=n,this._observable.onAny(n)},_onDeactivation:function(){var e=this._handler,n=this._observable;this._handler=null,n.offAny(e)}}),_=function(e){return function(t){if(t instanceof n.Observable)return new v(t,e);var r=a(t);return 0===r?e(t):1===r?new h([t,e]):new c([t,e],r)}};e.lift1Shallow=function(e){return function(t){return t instanceof n.Observable?new v(t,e):e(t)}},e.lift1=_,e.lift=function(e){var n=e.length;switch(n){case 0:return e;case 1:return _(e);default:return t.arityN(n,function(){for(var n=arguments.length,t=Array(n),r=0;r<n;++r)t[r]=arguments[r];var a=i(t);return 0===a?e.apply(null,t):(t.push(e),1===a&&new h(t),new c(t,a))})}},e.combines=f,e.default=f,Object.defineProperty(e,"__esModule",{value:!0})});
